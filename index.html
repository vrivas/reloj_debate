<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Reloj para debates</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <style>
        * {
            font-family: Arial, Helvetica, Sans;
        }

        body {
            color: black;
            background-color: white;
        }

        body.contraste {
            color: white;
            background-color: black;
        }

        input {
            border: 0pt;
            font-size: 1em;
            background-color: inherit;
            border-bottom: 1px solid #ddd;
            color: inherit;

        }

        input:hover {
            background-color: #ddd;
        }

        input:focus {
            background-color: #ddf;
            color: #229;
        }

        input[type="Submit"] {
            margin-right: 1em;
        }

        .fases,
        .duracion {
            margin: 1em;
        }

        .opcion-destacada {
            font-size: larger;
        }

        .opciones-principales {
            font-size: larger;
            margin: 3em;
        }
        #divIzquierda,
        #divDerecha {
            width: 49%;
        }

        .separador {
            height: .21em;
            background-color: #ddd;
            margin: 1em;
        }

        #divIzquierda {
            float: left;
        }

        #divDerecha {
            float: right;
            margin: 0 auto 0 auto;
        }

        #divDerecha {
            text-align: center;
        }

        .rojo {
            background-color: #daa;
        }

        .transparente {
            background-color: inherit;
        }

        label {
            width: 22%;
            display: block;
            float: left;
            padding: 0pt;
            margin: 0pt;
        }

        h1 {
            font-size: 150%;
        }

        h3 {
            font-size: 120%;
        }

        .HoraActual {
            margin-top: 2em;
            font-size: 3em;
        }

        #Quedan {
            font-size: 4em;
        }


        body {
            margin: 10px;
        }

        select {
            font-size: 70%;
        }

        .well-victor {
            background: rgb(22, 105, 173);
            color: #fff;
        }

        #datos {
            margin-left: 3em;
            font-size: 80%;
        }

        #MostrarComentarios {
            font-style: italic;
            color: #118;
            font-size: 120%;
        }

        .progress {
            height: 2em;
        }

        .progress-bar {

            padding-top: 0.25em;
            font-size: 120%;
        }
    </style>


    <script>

        var firstTime = true;

        function timers() {
            var now = new Date();
            var end = new Date();
            var init = new Date();
            now.setSeconds(0, 0);

            init.setHours(eval($("#HoraInicio").val().split(":")[0]));
            init.setMinutes(eval($("#HoraInicio").val().split(":")[1]));
            init.setSeconds(0, 0);

            end.setHours(eval($("#HoraFin").val().split(":")[0]));
            end.setMinutes(eval($("#HoraFin").val().split(":")[1]));
            end.setSeconds(0);

            // Diferencia en segundos entre la hora actual y la de final
            var dif = Math.trunc((end - now) / 60000);

            //Calculamos el porcentaje para la barra de progreso
            var porc = Math.trunc(100 * (now - init) / (end - init) + 0.5);
            porc = (porc > 100) ? 100 : porc;


            // Escribimos resultados
            if (!isNaN(dif)) {
                var horas = Math.trunc(dif / 60);
                var minutos = Math.trunc(dif % 60);
                var msje = ((dif > 0) ? "Quedan " : "El tiempo acabó hace ")
                    + ((horas != 0) ? (Math.abs(horas) + " horas y ") : "")
                    + (Math.abs(minutos)) + " minutos";
                if (horas <= 0 && minutos <= 10) {
                    $("#Quedan").css("color", "red");
                    $("#PorcProgress").addClass("progress-bar-danger");
                } else {

                    $("#Quedan").css("color", "inherit");
                    $("#PorcProgress").removeClass("progress-bar-danger");
                }
            } else {
                var msje = "<em>Indique una hora de finalización del examen, por favor.</em>";
                $("#divDerecha").addClass("transparente");
                $("#Quedan").css("color", "inherit");
            }


            $("#HoraActual").html(showHoursMinutes(now))
            $("#PorcProgress").css("width", porc + "%");
            $("#Porcentaje").html(porc);
            $("#Quedan").html(msje);
            $("#MostrarComentarios").html($('#Comentarios').val());
        }

        function initTimers(millisecs) {
            millisecs = (typeof millisecs == 'undefined') ? 1000 : millisecs;
            if (firstTime) {
                timers();
                firstTime = false;
            }
            setInterval(timers, millisecs);
        }

        function showHoursMinutes(moment) {
            return (((tmp = moment.getHours()) < 10) ? "0" : "") + tmp
                + ":"
                + (((tmp = moment.getMinutes()) < 10) ? "0" : "") + tmp;

        }
        function showDayMonthYear(moment) {
            return (((tmp = moment.getDate()) < 10) ? "0" : "") + tmp
                + "-"
                + (((tmp = moment.getMonth() + 1) < 10) ? "0" : "") + tmp
                + "-"
                + moment.getFullYear();

        }
    </script>
    <script>
        $(function () {
            /*$("#Ahora").click(function () {
             var now = new Date();
             var tmp;
             var toShow = (((tmp = now.getHours()) < 10) ? "0" : "") + tmp
             + ":"
             + (((tmp = now.getMinutes()) < 10) ? "0" : "") + tmp;
             $("#HoraInicio").val(toShow);
             });*/
            $("#Ahora").change(function () {
                if (this.value) {
                    var now = new Date();
                    $("#HoraInicio").val(showHoursMinutes(now));

                    now.setMinutes(now.getMinutes() + eval(this.value));
                    $("#HoraFin").val(showHoursMinutes(now));
                }
            });
            $("#HoraInicio").blur(function () {
                var tmp = this.value.toUpperCase();
                this.value = (tmp == "AHORA" || tmp == "'AHORA'" || tmp == "\"AHORA\"") ? showHoursMinutes(new Date()) : this.value;
            });
            $("#Fecha").blur(function () {
                var tmp = this.value.toUpperCase();
                this.value = (tmp == "HOY" || tmp == "'HOY'" || tmp == "\"HOY\"") ? showDayMonthYear(new Date()) : this.value;
            });

            $("#HoraFin").blur(function () {
                if (this.value.indexOf(":") != -1)
                    return;
                var minutes = eval(this.value);
                var now = new Date();
                now.setMinutes(now.getMinutes() + minutes);
                this.value = showHoursMinutes(now);
            });

            $("#ocultar").click(function () {
                if ($('#divIzquierda').is(':hidden')) {
                    $('#titulo').html("Reloj para exámenes");
                    $('#divDerecha').css('width', '49%');
                    $('#divIzquierda').fadeIn();
                    $('#datos').fadeOut();
                    $('#iconMostrar').removeClass("glyphicon-forward")
                        .addClass("glyphicon-backward");
                    $("body").removeClass("contraste");
                } else {
                    $('#titulo').html($('#Asignatura').val() + ", de " + $('#HoraInicio').val() + " a " + $('#HoraFin').val());
                    $('#divDerecha').css('width', '100%');
                    $('#divIzquierda').fadeOut();
                    $('#datos').fadeIn();
                    $('#iconMostrar').addClass("glyphicon-forward")
                        .removeClass("glyphicon-backward");
                    $("body").addClass("contraste");


                }
            });
            getParams();
            writeParams();
            initTimers(2000);
        });</script>
</head>

<body>

    <h1 class="well well-victor well-lg" id="titulo">Reloj para debates</h1>
    <div title="Pulse para ocultar o mostrar las opciones" id="ocultar">
        <span id="iconMostrar" class="glyphicon glyphicon-backward" aria-hidden="true"></span><span id="datos"></span>
    </div>
    <div class="well well-lg" id="divIzquierda">
        <form name="f1" id="f1" action="./" method="GET" title="Pulse para modificar">
            <div>
                <h3>Fases</h3>
                <div class="fases intro">
                    <input type="button" class="btn btn-primary" value="Introducción A" />
                    <input type="button" class="btn btn-primary" value="Introducción B" />
                </div>
                <div class="fases refutacion">
                    <input type="button" class="btn btn-primary" value="Refutación 1 A" />
                    <input type="button" class="btn btn-primary" value="Refutación 1 B" />
                    <input type="button" class="btn btn-primary" value="Refutación 2 A" />
                    <input type="button" class="btn btn-primary" value="Refutación 2 B" />
                </div>
                <div class="fases conclusion">
                    <input type="button" class="btn btn-primary" value="Conclusión A" />
                    <input type="button" class="btn btn-primary" value="Conclusión B" />
                </div>
            </div>
            <div>
                <h3>Duración</h3>
                <div class="duracion">
                    <input type="button" class="btn btn-primary" value="00:30" />
                    <input type="button" class="btn btn-primary" value="01:00" />
                    <input type="button" class="btn btn-primary" value="01:30" />
                    <input type="button" class="btn btn-primary" value="02:00" />
                    <input type="button" class="btn btn-primary" value="02:30" />
                    <input type="button" class="btn btn-primary" value="03:00" />
                    <input type="button" class="btn btn-primary" value="03:30" />
                    <input type="button" class="btn btn-primary" value="04:00" />
                </div>
            </div>
        </form>
    </div>
    <div id="divDerecha">
        <div class="info-fase"></div>
        <div class="info-duracion"></div>
        <div class="progress" style="width: 70%; margin: 0 auto;">
            <div class="progress-bar" role="progressbar" id="PorcProgress" aria-valuenow="0" aria-valuemin="0"
                aria-valuemax="100" style="min-width: 2em;">
                <span id="Porcentaje"></span>%
            </div>
        </div>
        <div class="opciones-principales">
            <input type="button" class="btn btn-primary opcion-destacada" value="Iniciar">
            <input type="button" class="btn btn-primary opcion-destacada" value="Detener">
        </div>
    </div>
</body>

</html>